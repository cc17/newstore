define("src/js/top/top",["src/js/libs/jquery","src/js/libs/subbyte","src/js/libs/template","src/js/libs/Dialog","src/js/libs/AppDialogTpl","src/js/libs/FixAppstatus","src/js/libs/Observer","src/js/libs/reportValue","src/js/libs/needUpdate","src/js/libs/mainNavItem","src/js/libs/returnToTop","src/js/libs/throttle","src/js/libs/debounce","src/js/libs/searchForm","src/js/libs/xss","src/js/libs/queryString","src/js/libs/urls_config"],function(a){function b(a){this.cache={};var b=this.$wrap=d(a.wrap);this.tpl=d(a.tpl).html(),this.body={week:b.find(".ranks_body_week"),recent:b.find(".ranks_body_recent")},this.getData.apply(this,arguments)}function c(a){new b(a)}var d=a("src/js/libs/jquery"),e=a("src/js/libs/subbyte"),f=a("src/js/libs/template"),g=a("src/js/libs/Dialog"),h=a("src/js/libs/AppDialogTpl"),i=a("src/js/libs/FixAppstatus"),j=a("src/js/libs/Observer");a("src/js/libs/returnToTop").init();var k=(a("src/js/libs/searchForm"),a("src/js/libs/urls_config")),l=k.offlineStatus?k.offline.topRank+"?t="+(new Date).getTime():k.online.topRank+"&t="+(new Date).getTime(),m={};return b.prototype={constructor:b,getData:function(){var a=this;d.ajax({url:l,beforeSend:function(){a.body.week.html('<div class="loading"></div>')}}).done(d.proxy(a.fixData,a))},fixData:function(a){if(a="string"==typeof a?JSON.parse(a):a,a.res){var b=a.info;delete b.recentnum;for(var c in b){var d=b[c];d=i.fixAppData(d),this.cache[c]=d,this.cacheData(c,d)}this.renderUi(this.cache)}},cacheData:function(a,b){d.each(b,function(a,b){m[b.app_uuid]=b})},getCacheByuuid:function(a){return m[a]},renderUi:function(a){var b=this,c=this.body;if(!d.isEmptyObject(a)){for(var g in a){var h=a[g];d.each(h,function(a,b){(a+1)%3==0&&(b.hideBorder=!0),b.app_summary&&(b.app_summary=e.subByte(b.app_summary,56))});var i=f(b.tpl,{data:h});c[g].html(i)}this.bindEvt()}},bindEvt:function(){var a=this.initTabBySearchQuery(),b=this.body,c=b[a],e=d(".ranks_header"),f=e.find("."+a);this.initTab(c,f),e.on("click","h3",function(){var e=d(this),g=e.attr("data-type");a!=g&&(f.removeClass("current"),e.addClass("current"),f=e,c.hide(),b[g].show(),c=b[g],a=g)}),this.$wrap.on("click","a.J-show-dialog",function(){var a,b=d(this),c=b.attr("data-uuid");if(c&&(a=m[c])){var e=h.render({data:a}),f=new g("x",{zIndex:20,title:"",w:952,h:580,noFixPos:!0,content:e,fixClass:"add-dialog",contentClass:"add-dialog-outer"});f.show()}}),j.register("updateData",this.updateData,this)},updateData:function(a,b){m[a]&&(m[a].installed=b?!1:!0)},initTabBySearchQuery:function(){var a=location.search;this.type=a&&a.indexOf("type")>0?a.split("&")[0].slice(6):"week";var b=d.inArray(this.type,["recent","week"])>=0;return!b&&(this.type="week"),this.type},initTab:function(a,b){a.show(),b.addClass("current")}},{start:c}});